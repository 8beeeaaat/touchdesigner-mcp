services:
  touchdesigner-mcp-server:
    build:
      context: .
      dockerfile: Dockerfile
      target: dev
    command: npm run dev:docker
    image: touchdesigner-mcp-server
    extra_hosts:
      - "host.docker.internal:host-gateway"
    ports:
      - "6274:6274"
      - "6277:6277"
      - "127.0.0.1:${MCP_HTTP_PORT:-6280}:${MCP_HTTP_PORT:-6280}"
    stdin_open: true
    tty: true
    restart: unless-stopped
    environment:
      - TRANSPORT=${TRANSPORT:-http}
      - MCP_HTTP_PORT=${MCP_HTTP_PORT:-6280}
      - MCP_HTTP_HOST=${MCP_HTTP_HOST:-0.0.0.0}
      - TD_HOST=${TD_HOST:-http://host.docker.internal}
      - TD_PORT=${TD_PORT:-9981}
    volumes:
      - .:/app
      - touchdesigner-mcp-node_modules:/app/node_modules
      - touchdesigner-mcp-dist:/app/dist

volumes:
  touchdesigner-mcp-node_modules:
  touchdesigner-mcp-dist:
