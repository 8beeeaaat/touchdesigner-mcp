# TouchDesigner MCP

TouchDesigner MCP is an implementation of the Model Context Protocol (MCP) server for TouchDesigner, aiming to enable AI agents to control and interact with TouchDesigner projects.

## Overview

![スクリーンショット 2025-04-14 21 45 47](https://github.com/user-attachments/assets/b7130ebe-406c-4e05-9efc-5d493eb800cb)

TouchDesigner MCP acts as a bridge between AI models and the TouchDesigner WebServer DAT, allowing AI agents to:
- Create, modify, and delete nodes
- Query node properties and project structure
- Programmatically control TouchDesigner using Python scripts

## Prerequisites

- Node.js (latest LTS version recommended)
- TouchDesigner (latest stable version recommended)
- Docker (Required for generating Python server code)

## Building the MCP Server Code

1. Clone the repository:
```bash
git clone https://github.com/8beeeaaat/touchdesigner-mcp.git
```

2. Install dependencies:
```bash
cd touchdesigner-mcp
npm install
```

3. Set up environment configuration and build:
```bash
# Copy the template and adjust TD_WEB_SERVER_URL if needed
cp dotenv .env

# Build the project (Generates API clients/servers and compiles MCP resources)
# Ensure Docker daemon is running before executing this command
npm run build
```

## Usage

### Setting Up TouchDesigner

1.  **Generate Code:**
Refer to [Building the MCP Server Code](#building-the-mcp-server-code) and run `npm run build` in the project root. This generates:
- MCP server code
- API server code for the TouchDesigner WebServer DAT

2.  **Import MCP WebServer into TouchDesigner:**
Launch TouchDesigner and import the `td/mcp_webserver_base.tox` component into your TouchDesigner project. The import triggers the `td/import_modules.py` script, which loads modules such as API server controllers.

3.  **Verify API Server:**
Ensure that the Python modules in the `td/modules` directory are accessible from the `mcp_webserver_base` component. Run `npm run test` to execute unit tests for the MCP server code and integration tests with TouchDesigner. You can view communication logs by opening the Textport from the TouchDesigner menu.

*TIPS*
The `mcp_webserver_base.tox` includes a WebServer DAT configured to integrate the MCP server with TouchDesigner. Ensure this DAT is active and running on the port specified in the `.env` file's `TD_WEB_SERVER_URL` (default: `9981`). To change the port:
1. Update `TD_WEB_SERVER_PORT` in the `.env` file.
2. Rebuild the project with `npm run build`.
3. Update the port in the WebServer DAT and restart it.

### Connecting to an MCP-Compatible AI Agent

With TouchDesigner running, configure an AI agent (e.g., Cursor, Claude Desktop, VSCode CopilotChat) to connect to the MCP server.

```json
// Example configuration (e.g., in VS Code settings.json for Copilot Chat)
"github.copilot.advanced": {
    "touchdesigner": {
        "command": "node",
        "args": [
            "/path/to/your/touchdesigner-mcp/dist/index.js", // <-- Replace with the absolute path generated by npm run build
            "--stdio"
        ],
        "transportType": "stdio"
    }
}
```

Once the API server is running in TouchDesigner, the agent can use the provided TouchDesigner tools.

## Project Structure Overview

```
├── src/                       # MCP server source code
│   ├── api/                  # OpenAPI specification for TD WebServer
│   ├── core/                 # Core utilities (logger, error handling)
│   ├── features/             # MCP feature implementations
│   │   ├── prompts/         # Prompt handlers
│   │   ├── resources/       # Resource handlers
│   │   └── tools/           # Tool handlers (e.g., tdTools.ts)
│   ├── gen/                  # Code generated from OpenAPI schema for MCP server
│   ├── server/               # MCP server logic (connections, main server class)
│   ├── tdClient/             # Client for TD connection API
│   ├── index.ts              # Main entry point for the Node.js server
│   └── ...
├── td/                        # TouchDesigner-related files
│   ├── modules/              # Python modules for TouchDesigner
│   │   ├── mcp/              # Core logic for handling MCP requests in TD
│   │   │   ├── controllers/ # API request controllers (api_controller.py, generated_handlers.py)
│   │   │   └── services/    # Business logic (api_service.py)
│   │   ├── td_server/        # Python model code generated from OpenAPI schema
│   │   └── utils/            # Shared Python utilities
│   ├── templates/             # Mustache templates for Python code generation
│   ├── genHandlers.js         # Node.js script for generating Python handlers
│   ├── import_modules.py      # Helper script for importing API server modules into TD
│   └── mcp_webserver_base.tox # Main TouchDesigner component
├── tests/                      # Test code
│   ├── integration/
│   └── unit/
├── .env                        # Local environment variables (gitignored)
├── dotenv                      # Template for .env
└── orval.config.ts             # Orval configuration (TS client generation)
```

## MCP Server Features

This server enables operations on TouchDesigner via the Model Context Protocol (MCP) and provides access to various tools.

### Tools

| Tool Name                   | Description                                           |
| :-------------------------- | :--------------------------------------------------- |
| `create_td_node`            | Creates a new node.                                  |
| `delete_td_node`            | Deletes an existing node.                            |
| `exec_node_method`          | Calls a Python method on a node.                     |
| `execute_python_script`     | Executes an arbitrary Python script in TD.           |
| `get_td_class_details`      | Retrieves details of TD Python classes/modules.      |
| `get_td_classes`            | Lists TouchDesigner Python classes.                 |
| `get_td_info`               | Retrieves information about the TD server environment. |
| `get_td_node_parameters`    | Retrieves parameters of a specific node.             |
| `get_td_nodes`              | Retrieves nodes within a parent path (optional filtering). |
| `update_td_node_parameters` | Updates parameters of a specific node.               |

### Prompts

Prompts allow AI agents to perform specific actions in TouchDesigner.

| Prompt Name                 | Description                                           |
| :-------------------------- | :--------------------------------------------------- |
| `Search node`               | Performs a fuzzy search for nodes based on name, family, or type. |
| `Node connection`           | Provides instructions for connecting nodes in TouchDesigner. |
| `Check node errors`         | Checks for errors in specified nodes, recursively if child nodes exist. |

### Resources

Not implemented.

## Development

### Setting Up the Development Environment

```bash
# Install dependencies
npm install

# Run linters and type checkers
npm run lint

# Run tests
npm test

# Start the server with MCP Inspector for debugging
npm run dev
```

### API Code Generation Workflow

This project uses OpenAPI-based code generation tools (Orval / openapi-generator-cli):

**API Definition:** The API contract between the Node.js MCP server and the Python server running in TouchDesigner is defined in `src/api/index.yml`.

1.  **Python Server Generation (`npm run gen:webserver`):**
    *   Uses Docker to run `openapi-generator-cli`.
    *   Reads `src/api/index.yml`.
    *   Generates Python server skeleton (`td/modules/td_server/`) for the WebServer DAT in TouchDesigner.
    *   **Requires Docker to be installed and running.**
2.  **Python Handler Generation (`npm run gen:handlers`):**
    *   Uses a custom Node.js script (`td/genHandlers.js`) and Mustache templates (`td/templates/`).
    *   Generates handler implementations (`td/modules/mcp/controllers/generated_handlers.py`) that connect to business logic in `td/modules/mcp/services/api_service.py`.
3.  **TypeScript Client Generation (`npm run gen:mcp`):**
    *   Uses `Orval` to generate a TypeScript client (`src/tdClient/`) for the Node.js server to communicate with the Python server.

The build process (`npm run build`) executes all generation steps (`npm run gen`) and compiles TypeScript (`tsc`).

## Contributing

Contributions are welcome! Follow these steps:

1. Fork the repository.
2. Create a feature branch (`git checkout -b feature/amazing-feature`).
3. Make your changes.
4. Add tests and ensure everything works (`npm test`).
5. Commit your changes (`git commit -m 'Add some amazing feature'`).
6. Push to the branch (`git push origin feature/amazing-feature`).
7. Open a Pull Request.

Ensure your code follows the project's coding standards and includes appropriate tests.

## License

MIT
